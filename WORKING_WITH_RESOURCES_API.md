# Working with the Resources API


## Overview

The SignalK specification defines a number of resources (routes, waypoints, notes, regions & charts) each with its own path under the root `resources` path _(e.g. `/signalk/v2/api/resources/routes`)_.

The SignalK server validates requests to these resource paths and passes them to a [Resource Provider plugin](RESOURCE_PROVIDER_PLUGINS.md) for storage and retrieval. 

 _You can find plugins in the `App Store` section of the server admin UI._

Client applications can then use `HTTP` requests to these paths to store (`POST`, `PUT`), retrieve (`GET`) and remove (`DELETE`) resource entries. 

_Note: the ability to store resource entries is controlled by the server security settings so client applications may need to authenticate for write / delete operations to complete successfully._


### Retrieving Resources
---

Resource entries are retrived by submitting an HTTP `GET` request to the relevant path.

For example to return a list of all available routes
```typescript
HTTP GET 'http://hostname:3000/signalk/v2/api/resources/routes'
```
 or alternatively fetch a specific route.
```typescript
HTTP GET 'http://hostname:3000/signalk/v2/api/resources/routes/urn:mrn:signalk:uuid:94052456-65fa-48ce-a85d-41b78a9d2111'
```

A filtered list of entries can be retrieved based on criteria such as:

- being within a bounded area
- distance from vessel
- total entries returned

by supplying a query string containing `key | value` pairs in the request.

_Example 1: Retrieve waypoints within 50km of the vessel. Note: distance in meters value should be provided._

```typescript
HTTP GET 'http://hostname:3000/signalk/v2/api/resources/waypoints?distance=50000'
```

_Example 2: Retrieve up to 20 waypoints within 90km of the vessel._

```typescript
HTTP GET 'http://hostname:3000/signalk/v2/api/resources/waypoints?distance=90000&limit=20'
```

_Example 3: Retrieve waypoints within a bounded area. Note: the bounded area is supplied as bottom left & top right corner coordinates in the form swLongitude,swLatitude,neLongitude,neLatitude_.

```typescript
HTTP GET 'http://hostname:3000/signalk/v2/api/resources/waypoints?bbox=-135.5,38,-134,38.5'
```


### Deleting Resources
---

Resource entries are deleted by submitting an HTTP `DELETE` request to a path containing the `id` of the resource to delete.

_Example: Delete from storage the route with id `urn:mrn:signalk:uuid:94052456-65fa-48ce-a85d-41b78a9d2111`._

```typescript
HTTP DELETE 'http://hostname:3000/signalk/v2/api/resources/routes/urn:mrn:signalk:uuid:94052456-65fa-48ce-a85d-41b78a9d2111'
```


### Creating / updating Resources
---

__Creating a new resource entry:__

Resource entries are created by submitting an HTTP `POST` request to a path for the relevant resource type. 

```typescript
HTTP POST 'http://hostname:3000/signalk/v2/api/resources/routes' {resource_data}
```

The new resource is created and its `id` (generated by the server) is returned in the response message.

```JSON
{
  "state": "COMPLETED",
  "statusCode": 200,
  "id": "urn:mrn:signalk:uuid:94052456-65fa-48ce-a85d-41b78a9d2111"
}
```

_Note: Each `POST` will generate a new `id` so if the resource data remains the same duplicate resources will be created._

__Updating a resource entry:__

Resource entries are updated by submitting an HTTP `PUT` request to a path for the relevant resource type that includes the resource `id`.

```typescript
HTTP PUT 'http://hostname:3000/signalk/v2/api/resources/waypoints/urn:mrn:signalk:uuid:94052456-65fa-48ce-a85d-41b78a9d2111'
```

As the `PUT` request replaces the record with the supplied `id`,  the submitted resource data should contain a complete record for the resource type being written.

Each resource type has a specific set of attributes that are required to be supplied before the resource entry can be created or updated.

If either the submitted resource data or the resource id are invalid then the operation is aborted._

_Note: the submitted resource data is validated against the OpenApi schema definition for the relevant resource type._

---

### Creating Routes, Waypoints & Regions using `POST`

The Signal K Resources API provides for `POST` requests to create routes, waypoints and regions to only require the resource coordinates.

See the following sections for information relating to each of these resoource types.

---
#### __Routes:__

To create a new route entry the body of the request must contain data in the following format: 
```javascript
{
  points: [
    {latitude: -38.567,longitude: 135.9467},
    {latitude: -38.967,longitude: 135.2467},
    {latitude: -39.367,longitude: 134.7467},
    {latitude: -39.567,longitude: 134.4467}
  ],
  name: 'route name',
  description: 'description of the route',
  properties: {
    ...
  }
}
```
where:
- `points (required)`: is an array of route points (latitude and longitude)
- `name`: is text detailing the name of the route
- `description`: is text describing the route
- `properties`: object containing key | value pairs of attributes associated with the route.


_Example: Create new route entry using only required attributes._

```typescript 
HTTP POST 'http://hostname:3000/signalk/v2/api/resources/routes' {
  points: [
    {latitude: -38.567,longitude: 135.9467},
    {latitude: -38.967,longitude: 135.2467},
    {latitude: -39.367,longitude: 134.7467},
    {latitude: -39.567,longitude: 134.4467}
  ]
}
```


---
#### __Waypoints:__

To create a new waypoint entry the body of the request must contain data in the following format: 
```javascript
{
  position: {
    latitude: -38.567,
    longitude: 135.9467
  },
  name: 'waypoint name',
  description: 'description of the waypoint',
  properties: {
    ...
  }
}
```
where:
- `position (required)`: the latitude and longitude of the waypoint
- `name`: is text detailing the name of the waypoint
- `description`: is text describing the waypoint
- `properties`: object containing key | value pairs of attributes associated with the waypoint.


_Example: Create new waypoint entry using only required attributes._
```typescript
HTTP POST 'http://hostname:3000/signalk/v2/api/resources/waypoints' {
  position: {
    latitude: -38.567,
    longitude: 135.9467
  }
}
```

---
#### __Regions:__

To create a new region entry the body of the request must contain data in the following format(s):

```javascript
{
  points: [ ... ],
  name: 'region name',
  description: 'description of the region',
  attributes: {
    ...
  }
}
```
where:
- `points (required)`: is an array containing coordinates defining a "closed" area in one of the formats listed below. 
- `name`: is text detailing the name of the region
- `description`: is text describing the region
- `properties`: object containing key | value pairs of attributes associated with the region.


**format 1: Single Bounded Area (SBA)**

An array of points (latitude and longitude) defining the area.

```javascript
{
  points: [
    {latitude: -38.567,longitude: 135.9467},
    {latitude: -38.967,longitude: 135.2467},
    {latitude: -39.367,longitude: 134.7467},
    {latitude: -39.567,longitude: 134.4467},
    {latitude: -38.567,longitude: 135.9467}
  ]
}
```

**format 2: Bounded area containing other areas (Polygon)**

An array of Single Bounded Areas (`format 1`). The first entry of the array defines an area which contains the areas defined in the remainder of the array entries.

```javascript
{
  points: [
    [
      {latitude: -38.567,longitude: 135.9467},
      ...
      {latitude: -38.567,longitude: 135.9467}
    ],
    [
      {latitude: -39.167,longitude: 135.567},
      ...
      {latitude: -39.167,longitude: 135.567}
    ]
  ]
}
```


**format 3: Multiple Bounded areas (MultiPolygon)**

An array of Polygons (`format 2`).

```javascript
{
  name: 'region name',
  description: 'description of the region',
  attributes: {
    ...
  },
  points: [
    [
      [
        {latitude: -38.567,longitude: 135.9467},
        ...
        {latitude: -38.567,longitude: 135.9467}
      ],
      [
        {latitude: -39.167,longitude: 135.567},
        ...
        {latitude: -39.167,longitude: 135.567}
      ]
    ],
    [
      [
        {latitude: -40.567,longitude: 135.9467},
        ...
        {latitude: -40.567,longitude: 135.9467}
      ],
      [
        {latitude: -41.167,longitude: 135.567},
        ...
        {latitude: -41.167,longitude: 135.567}
      ]
    ]
  ]
}
```


_Example: Create new region entry using only required attributes._
```typescript
HTTP POST 'http://hostname:3000/signalk/v2/api/resources/regions' {
  points: [
    {latitude: -38.567,longitude: 135.9467},
    {latitude: -38.967,longitude: 135.2467},
    {latitude: -39.367,longitude: 134.7467},
    {latitude: -39.567,longitude: 134.4467},
    {latitude: -38.567,longitude: 135.9467}
  ]
}
```
